---
page_type: sample
products:
- ms-graph
languages:
- csharp
description: "Данные безопасности, доступные через Microsoft Graph Security API, очень чувствительны и поэтому защищены разрешениями и ролями Azure AD"
extensions:
  contentType: samples
  technologies:
  - Mcirosoft Graph
  - Microsoft Graph
  services:
  - Security 
  createdDate: 4/19/2018 10:35:33 AM
---
# Пример приложения проверки подлинности Microsoft Graph C #

## Введение

Данные безопасности, доступные через Microsoft Graph Security API, очень чувствительны и поэтому защищены ролями разрешений (или областями) и ролями Azure AD (AAD).
Microsoft Graph Security API обеспечивает аутентификацию и авторизацию (AuthNZ) для защиты конфиденциальных данных, которые он делает доступными. Более подробно это описано в разделе [Понимание авторизации при вызове Microsoft Graph Security API](https://techcommunity.microsoft.com/t5/Using-Microsoft-Graph-Security/Authorization-and-Microsoft-Graph-Security-API/m-p/184376#M2) в техническом сообществе Microsoft Graph Security API. 

## Аутентификация и авторизация в Microsoft Graph

Microsoft Graph Security API поддерживает два типа аутентификации и авторизации приложений (также называемые AuthNZ):
* **Авторизация только для приложений**, когда нет зарегистрированного пользователя (например, стандартный SIEM или сценарий автоматизации).
Здесь разрешения / области, предоставленные приложению, определяют авторизацию.
* **Делегированная авторизация пользователя**, в которой зарегистрирован пользователь, являющийся членом арендатора AAD.

Чтобы вызвать Microsoft Graph Security API, пользователь должен принадлежать к роли администратора AAD Security Reader Limited, в [**регистрации приложения**](https://go.microsoft.com/fwlink/?linkid=2083908) должны быть определены необходимые разрешения (или области действия), а клиенту Azure AD должны быть предоставлены необходимые разрешения. Администратор. Этот процесс также описан в примере [Microsoft Graph Security API для ASP.NET 4.6 (REST)](https://github.com/microsoftgraph/aspnet-security-api-sample)

Этот пример приложения проверки подлинности графа обеспечивает более полное представление о обоих типах AuthNZ при вызове Microsoft Graph Security API, отображая содержимое маркера авторизации, а также содержимое и заголовки ответа.
В приложении есть одна вкладка для делегированной аутентификации пользователя, а другая - только для аутентификации приложения.
Оно также имеет вкладку **справки** с некоторыми распространенными ошибками и исправлениями.
Приложение также позволяет вам ввести запрос REST по вашему выбору, чтобы увидеть ответ. 

## Необходимая информация для запуска приложения

Информация, которая понадобится вам для запуска приложения Graph Authentication:
![Для обоих типов аутентификации]:
* **Идентификатор приложения** - от регистрации приложения (все, что вам нужно для делегированной аутентификации пользователя)
![Для аутентификации только для приложения] (в дополнение к Идентификатор приложения)
* **Ключ приложения** (также известный как App Secret) - также из регистрации приложения
* **Идентификатор клиента** (идентификатор вашего клиента Azure AD) - это обязательное свойство любого объекта Microsoft Graph Security API (ответ)

## Начало работы с примером приложения для проверки подлинности графа

 1. Загрузите или клонируйте образец проверки подлинности Microsoft Graph.

 2. Если вы не зарегистрировали приложение, не определили необходимые разрешения и явно не предоставили эти разрешения, следуйте инструкциям в примере [Microsoft Graph Security API для ASP.NET 4.6 (REST)](https://github.com/microsoftgraph/aspnet-security-api-sample), чтобы сделать это. (Обязательно сохраните ключ приложения (он же секрет приложения) при регистрации примера приложения).

 3. Не забудьте добавить **собственное приложение** на страницу регистрации приложения, если вы используете пример ASP.NET. Это требуется для примера приложения Microsoft Graph Security Authentication.Это требуется для примера приложения для проверки подлинности Microsoft Graph.
 
 ## Настройка и запуск примера приложения
 1. Откройте проект Graph\_Security\_API\_Auth\_Sample.
 
 2. Нажмите клавишу F5 для сборки и запуска примера. Это восстановит зависимости пакета NuGet и откроет приложение.

   >Если при установке пакетов возникают ошибки, убедитесь, что локальный путь к решению не слишком длинный. Перемещение решения ближе к корню вашего диска решит эту проблему.

## Использование примера приложения Microsoft Graph Authentication

1. При запуске примера приложения отобразится пользовательский интерфейс примера приложения

![Образец пользовательского интерфейса приложения проверки подлинности графа](readme-images/Default_screen.png)

2. Введите идентификатор приложения в текстовое поле в верхней части страницы.

## Тестирование Пользователь делегировал авторизацию

1. Чтобы запустить процедуру делегированной аутентификации пользователя, нажмите кнопку **Отправить запрос**. Откроется диалоговое окно аутентификации Microsoft.

2. Войдите со своей рабочей или учебной учетной записью.

3. Пользовательский интерфейс приложения Sample отобразит токен Auth на левой панели, как показано ниже. 

![Пример аутентификации графа - делегированная авторизация пользователя](readme-images/User_delegated_auth.png)

* Свойство **scp** (выделено) показывает области или разрешения, предоставленные пользователю
* В свойстве **wids** показаны GUID групп пользователей, к которым относится пользователь.

4. Ответ на запрос REST, который появляется в текстовом поле «URL-адрес графика» (его значение по умолчанию возвращает начало, т. Е. Последнее, предупреждение). Это полный ответ JSON, полученный от Microsoft Graph Security API. При нажатии кнопки **заголовка** ответа выводится заголовок HTTP ответа.

* Примечание: Вы можете изменить запрос REST, отправленный в Microsoft Graph Security API, отредактировав URL в текстовом поле **Graph URL**

## Тестирование авторизации только для приложений (без входа в систему)

1. Чтобы запустить поток аутентификации только для приложений, вам необходимо:

* Введите ключ приложения (или секрет приложения), который был сгенерирован при регистрации приложения.
* Введите идентификатор клиента AAD (вы можете получить его из свойства "azureTenantId" в ответе в делегированном выше пользовательском потоке аутентификации)
* Нажмите кнопку **Отправить запрос**. 

2. Пользовательский интерфейс примера приложения отобразит маркер авторизации только для приложения на левой панели, как показано ниже. 

![Пример аутентификации графа - авторизация только для приложения](readme-images/App_only_auth.png)

* Здесь свойство **роли** (выделено) показывает области или разрешения, предоставленные приложению
* Ответ JSON на запрос REST такой же, как и в предыдущем примере

## Вкладка Справка

Вкладка **Справка** содержит некоторые распространенные ошибки, причину их возникновения и способы их устранения (исправления). 

![Пример проверки подлинности графика - вкладка Справка](readme-images/Help_tab.png)

## Ресурсы

Документация:
* [Понимание авторизации при вызове Microsoft Graph Security API](https://techcommunity.microsoft.com/t5/Using-Microsoft-Graph-Security/Authorization-and-Microsoft-Graph-Security-API/m-p/184376#M2)
* [Справочник по разрешениям Microsoft Graph](https://developer.microsoft.com/en-us/graph/docs/concepts/permissions_reference)

Другие примеры:
* [Пример Microsoft Graph Security API для ASP.NET 4.6 (REST)](https://github.com/microsoftgraph/aspnet-security-api-sample)
